class NextObserver{constructor(){this.observerGroups=new Map();this.lastClientX=0;this.lastClientY=0;this.maxRotateX=20;this.maxRotateY=20;this.handleScroll=this.handleScroll.bind(this);this.handleMouseMove=this.handleMouseMove.bind(this);this.init()}
static instance=null;static initialize(){if(NextObserver.instance){NextObserver.instance.destroy()}
NextObserver.instance=new NextObserver()}
init(){this.collectObservers();this.bindEvents()}
collectObservers(){const observers=document.querySelectorAll('.dan-observer');observers.forEach(observer=>{const target=observer.getAttribute('data-observe')||'body';if(!this.observerGroups.has(target)){this.observerGroups.set(target,{elements:[],config:{constrain:parseFloat(observer.getAttribute('data-constrain')),perspective:observer.getAttribute('data-perspective')}})}
this.observerGroups.get(target).elements.push(observer)});this.observerGroups.forEach((group,selector)=>{this.setupObserverGroup(selector,group)})}
setupObserverGroup(selector,group){const targetElements=document.querySelectorAll(selector);targetElements.forEach(target=>{target.addEventListener('mousemove',e=>{this.updateTransform(e,group.elements,group.config)})})}
calculateTransform(clientX,clientY,element,config){const rect=element.getBoundingClientRect();let rotateX=-(clientY-rect.y-rect.height/2)/config.constrain;let rotateY=(clientX-rect.x-rect.width/2)/config.constrain;rotateX=Math.max(-this.maxRotateX,Math.min(this.maxRotateX,rotateX));rotateY=Math.max(-this.maxRotateY,Math.min(this.maxRotateY,rotateY));return `perspective(${config.perspective}px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`}
updateTransform(event,elements,config){elements.forEach(element=>{window.requestAnimationFrame(()=>{element.style.transform=this.calculateTransform(event.clientX,event.clientY,element,config)})})}
handleScroll(){const pointerEvent=new MouseEvent('mousemove',{clientX:this.lastClientX,clientY:this.lastClientY});this.observerGroups.forEach(group=>{this.updateTransform(pointerEvent,group.elements,group.config)})}
handleMouseMove(event){this.lastClientX=event.clientX;this.lastClientY=event.clientY}
bindEvents(){window.addEventListener('scroll',this.handleScroll);window.addEventListener('mousemove',this.handleMouseMove)}
destroy(){window.removeEventListener('scroll',this.handleScroll);window.removeEventListener('mousemove',this.handleMouseMove);this.observerGroups.forEach((group,selector)=>{const targetElements=document.querySelectorAll(selector);targetElements.forEach(target=>{target.onmousemove=null})});this.observerGroups.forEach(group=>{group.elements.forEach(element=>{element.style.transform=''})});this.observerGroups.clear();this.lastClientX=0;this.lastClientY=0}}
function dancepad_observer(){NextObserver.initialize()}