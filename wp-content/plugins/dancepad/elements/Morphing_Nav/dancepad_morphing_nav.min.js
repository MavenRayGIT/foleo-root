class NextMorphingNav{constructor(element){this.element=element;this.wrapper=this.element.closest('.dan-morphing-nav');this.elementId=this.element.getAttribute('id');this.targets=this.wrapper.querySelectorAll(`[data-morph-bg="${this.elementId}"]`);this.bgTargets=[];this.action=this.element.getAttribute('data-morph-bg-event')||'click';this.targetIndex=!1;this.defaultIndex=!1;this.lastClickedIndex=null;this.hoveredIndex=null;this.init()}
static instances=[];static initialize(){const morphingDivs=document.querySelectorAll('.dan-morphing-nav__morphing-div');morphingDivs.forEach(element=>{const instance=new NextMorphingNav(element);NextMorphingNav.instances.push(instance)})}
static destroyAll(){NextMorphingNav.instances.forEach(instance=>instance.destroy());NextMorphingNav.instances=[]}
init(){this.initializeBgTargets();this.handlePageNameOrActiveItem();this.findDefaultIndex();this.setupEventListeners();this.initializeActiveStates()}
initializeBgTargets(){this.bgTargets=Array.from(this.targets).map(target=>target.querySelector('[data-morph-bg-target]')||target)}
handlePageNameOrActiveItem(){if(this.wrapper.getAttribute('data-page-name')=='1'){const pageNameValue=this.wrapper.getAttribute('data-page-name');if(pageNameValue==="1"){const postTitle=window.location.pathname.split('/').filter(Boolean).pop();if(postTitle){this.targets.forEach(target=>{if(target.textContent.trim()===postTitle){target.setAttribute('data-morph-bg-active','')}else{target.removeAttribute('data-morph-bg-active')}})}}else{const pageName=pageNameValue;this.targets.forEach(target=>{if(target.textContent.trim()===pageName){target.setAttribute('data-morph-bg-active','')}else{target.removeAttribute('data-morph-bg-active')}})}}else if(this.wrapper.hasAttribute('data-active-item')){const activeIndex=parseInt(this.wrapper.getAttribute('data-active-item'),10)-1;const items=this.wrapper.querySelectorAll('.dan-morphing-nav__item');items.forEach((item,index)=>{if(index===activeIndex){item.setAttribute('data-morph-bg-active','')}else{item.removeAttribute('data-morph-bg-active')}})}}
findDefaultIndex(){for(let i=0;i<this.targets.length;i++){if(this.targets[i].hasAttribute('data-morph-bg-active')){this.updateMorphing(i);this.defaultIndex=i;break}}}
updateMorphing(index){if(!this.bgTargets)return;const targetRect=this.bgTargets[index].getBoundingClientRect();const borderRadius=getComputedStyle(this.bgTargets[index]).borderRadius;const wrapperRect=this.wrapper.getBoundingClientRect();this.element.style.transform=`translateX(${targetRect.left - wrapperRect.left}px) 
                                      translateY(${targetRect.top - wrapperRect.top}px) 
                                      translateZ(-0.1px)`;this.element.style.height=`${targetRect.height}px`;this.element.style.width=`${targetRect.width}px`;this.element.style.borderRadius=borderRadius;this.element.classList.add('morph-bg--visible');setTimeout(()=>{if(!this.element.classList.contains('morph-bg--has-transition')){this.element.classList.add('morph-bg--has-transition')}},10);this.targetIndex=index}
resetToActiveItem(){if(this.lastClickedIndex!==null){this.updateMorphing(this.lastClickedIndex)}else{this.targets.forEach((target,index)=>{if(target.hasAttribute('data-morph-bg-active')){this.updateMorphing(index);target.classList.add('dan-morphing-nav__item--active')}else{target.classList.remove('dan-morphing-nav__item--active')}})}}
handleMouseLeave(event){if(!event.relatedTarget||(!event.relatedTarget.closest(`[data-morph-bg="${this.elementId}"]`)&&!event.relatedTarget.closest('[data-morph-bg-preserve]'))){if(this.defaultIndex!==!1){this.targetIndex=this.defaultIndex;this.updateMorphing(this.targetIndex);return}
this.element.classList.remove('morph-bg--visible','morph-bg--has-transition');this.targetIndex=!1}}
setupEventListeners(){const trigger=this.wrapper.getAttribute('data-trigger');if(trigger==='hover'){this.setupHoverEvents()}else if(trigger==='click'){this.setupClickEvents()}
this.handleResize=()=>{if(this.targetIndex!==!1){this.updateMorphing(this.targetIndex)}};window.addEventListener('resize',this.handleResize);window.addEventListener('update-morphbg',()=>{if(this.targetIndex!==!1){this.updateMorphing(this.targetIndex);this.element.style.display=''}});window.addEventListener('hide-morphbg',()=>{if(!this.element.classList.contains('dan-morphing-nav')){this.element.style.display='none'}})}
setupHoverEvents(){this.wrapper.addEventListener('mouseleave',()=>this.resetToActiveItem());this.targets.forEach((target,index)=>{target.addEventListener('mouseenter',()=>{this.hoveredIndex=index;this.targets.forEach(t=>t.classList.remove('dan-morphing-nav__item--active'));target.classList.add('dan-morphing-nav__item--active');this.updateMorphing(index)});target.addEventListener('mouseleave',()=>{this.hoveredIndex=null;if(this.lastClickedIndex!==null){this.updateMorphing(this.lastClickedIndex);this.targets.forEach((t,i)=>{t.classList.toggle('dan-morphing-nav__item--active',i===this.lastClickedIndex)})}});this.setupFocusAndClickEvents(target,index)});const preserveElement=this.targets[0]?.closest('[data-morph-bg-preserve]');if(preserveElement){preserveElement.addEventListener('mouseleave',(event)=>{if(this.hoveredIndex===null&&this.lastClickedIndex!==null){this.updateMorphing(this.lastClickedIndex)}else{this.handleMouseLeave(event)}})}
document.addEventListener('mouseleave',()=>this.resetToActiveItem())}
setupClickEvents(){this.targets.forEach((target,index)=>{target.addEventListener('click',()=>{this.updateMorphing(index);this.targets.forEach(t=>t.classList.remove('dan-morphing-nav__item--active'));target.classList.add('dan-morphing-nav__item--active')});target.addEventListener('focus',()=>{this.updateMorphing(index);this.targets.forEach(t=>t.classList.remove('dan-morphing-nav__item--active'));target.classList.add('dan-morphing-nav__item--active')})})}
setupFocusAndClickEvents(target,index){target.addEventListener('focus',()=>{this.targets.forEach(t=>t.classList.remove('dan-morphing-nav__item--active'));target.classList.add('dan-morphing-nav__item--active');this.updateMorphing(index);target.setAttribute('data-morph-bg-active','');this.lastClickedIndex=index});target.addEventListener('click',()=>{this.targets.forEach(t=>t.classList.remove('dan-morphing-nav__item--active'));target.classList.add('dan-morphing-nav__item--active');this.updateMorphing(index);target.setAttribute('data-morph-bg-active','');this.lastClickedIndex=index})}
initializeActiveStates(){this.targets.forEach(target=>{if(target.hasAttribute('data-morph-bg-active')){target.classList.add('dan-morphing-nav__item--active')}})}
destroy(){window.removeEventListener('resize',this.handleResize);this.element.classList.remove('morph-bg--visible','morph-bg--has-transition');this.element.style.transform='';this.element.style.height='';this.element.style.width='';this.element.style.borderRadius='';this.targets.forEach(target=>{target.classList.remove('dan-morphing-nav__item--active');target.removeAttribute('data-morph-bg-active')});this.element=null;this.wrapper=null;this.targets=null;this.bgTargets=null}}
function dancepad_morphing_nav(){NextMorphingNav.destroyAll();NextMorphingNav.initialize();initializeMorphingNavObserver()}
function initializeMorphingNavObserver(){const breakdanceCanvas=document.querySelector('#breakdance_canvas');if(!breakdanceCanvas)return;const observer=new MutationObserver((mutations)=>{for(const mutation of mutations){if(mutation.type==='childList'){const hasNewItem=Array.from(mutation.addedNodes).some(node=>node.classList&&(node.classList.contains('dan-morphing-nav__item')||node.classList.contains('dan-morphing-nav__morphing-div')));if(hasNewItem){dancepad_morphing_nav();break}}}});const morphingElements=document.querySelectorAll('.dan-morphing-nav');morphingElements.forEach(element=>{observer.observe(element,{childList:!0,subtree:!0})});return observer}