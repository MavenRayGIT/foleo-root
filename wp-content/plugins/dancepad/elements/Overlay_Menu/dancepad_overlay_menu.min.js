class NextOverlayMenu{constructor(element){this.menu=element;this.content=element.querySelector('.dan-overlay-menu__content');this.burgerButtons=element.querySelectorAll('.dan-burger');this.isOpen=!1;this.hasScrollLock=!1;this.timeline=null;this.observer=null;this.config=this.initConfig();this.toggleMenu=this.toggleMenu.bind(this);this.handleClickOutside=this.handleClickOutside.bind(this);this.handleEscKey=this.handleEscKey.bind(this);this.handleFocusOut=this.handleFocusOut.bind(this);this.init()}
static instances=[];static destroyAll(){NextOverlayMenu.instances.forEach(instance=>instance.destroy());NextOverlayMenu.instances=[]}
initConfig(){return{customToggle:this.menu.getAttribute('data-customtoggle'),closeOnEsc:this.menu.getAttribute('data-close-on-esc')==='1',toggleBodyScroll:this.menu.getAttribute('data-customtoggle-lock-body-scrolling')==='1',duration:this.menu.getAttribute('data-duration'),easing:this.menu.getAttribute('data-easing'),fade:this.menu.getAttribute('data-fade')!=='1'?0.001:parseFloat(this.menu.getAttribute('data-duration'))}}
init(){this.initTimeline();this.setupCustomToggles();this.bindEvents();this.setupMutationObserver();this.manipulateTabIndexes()}
initTimeline(){this.timeline=gsap.timeline({paused:!0});this.timeline.to(this.content,{duration:this.config.fade,ease:this.config.easing,opacity:1,onStart:()=>this.menu.removeAttribute('data-aux-fade'),onReverseComplete:()=>this.menu.setAttribute('data-aux-fade','1')})}
manipulateTabIndex(element){if(element.hasAttribute('tabindex')&&element.getAttribute('tabindex')==='-1'){element.removeAttribute('tabindex')}else{element.setAttribute('tabindex','-1')}
Array.from(element.children).forEach(child=>this.manipulateTabIndex(child))}
applyTabIndexRecursively(element){if(element.nodeType===Node.ELEMENT_NODE){if(!element.hasAttribute('tabindex')||element.getAttribute('tabindex')!=='-1'){element.setAttribute('tabindex','-1')}
Array.from(element.children).forEach(child=>this.applyTabIndexRecursively(child))}}
setupMutationObserver(){this.observer=new MutationObserver(mutations=>{mutations.forEach(mutation=>{if(mutation.type==='childList'){mutation.addedNodes.forEach(node=>{if(node.nodeType===Node.ELEMENT_NODE){this.applyTabIndexRecursively(node)}})}})});this.observer.observe(this.content,{childList:!0,subtree:!0})}
setupCustomToggles(){if(!this.config.customToggle)return;const toggles=document.querySelectorAll(this.config.customToggle);toggles.forEach(toggle=>{if(!toggle.hasAttribute('tabindex')){toggle.setAttribute('tabindex','0')}
toggle.addEventListener('click',()=>{this.toggleBodyScroll();this.toggleMenu()});toggle.addEventListener('keydown',(event)=>{if(event.key==='Enter'){this.toggleBodyScroll();this.toggleMenu();event.stopImmediatePropagation()}})})}
toggleMenu(){this.isOpen=!this.isOpen;if(this.isOpen){this.content.style.pointerEvents='all';this.menu.setAttribute('data-open','dan-overlay-menu--opened');this.timeline.play();this.manipulateTabIndex(this.content)}else{this.content.style.pointerEvents='none';this.menu.removeAttribute('data-open');this.timeline.reverse();this.applyTabIndexRecursively(this.content);const html=document.querySelector('html');if(html?.hasAttribute('dan-burger--body-toggled')){html.removeAttribute('dan-burger--body-toggled');window.lenisInstance?.start()}}
if(this.burgerButtons.length>0){this.burgerButtons.forEach(burger=>this.updateBurgerToggle(burger))}
if(this.config.customToggle){const toggles=document.querySelectorAll(this.config.customToggle);toggles.forEach(toggle=>{if(toggle.classList.contains('dan-burger')){this.updateBurgerToggle(toggle)}else{this.updateCustomToggle(toggle)}})}}
updateBurgerToggle(burger){const button=burger.querySelector('button');if(!button)return;const existingClasses=Array.from(button.classList);existingClasses.forEach(className=>{if(className.includes('--opened')){button.classList.remove(className)}});if(this.isOpen){const baseClasses=existingClasses.filter(className=>(className.startsWith('dan-burger-')||className.startsWith('hamburger--'))&&!className.includes('--opened'));baseClasses.forEach(baseClass=>{button.classList.add(`${baseClass}--opened`)})}
button.setAttribute('aria-expanded',this.isOpen?'true':'false')}
updateCustomToggle(toggle){if(this.isOpen){toggle.classList.add('opened')}else{toggle.classList.remove('opened')}}
toggleBodyScroll(){const shouldToggleScroll=this.config.toggleBodyScroll||this.hasScrollLock;if(!shouldToggleScroll)return;const html=document.querySelector('html');if(html.hasAttribute('dan-burger--body-toggled')){window.lenisInstance?.start();html.removeAttribute('dan-burger--body-toggled')}else{window.lenisInstance?.stop();html.setAttribute('dan-burger--body-toggled','')}}
handleClickOutside(event){const isClickInside=this.content.contains(event.target)||(this.config.customToggle&&Array.from(document.querySelectorAll(this.config.customToggle)).some(toggle=>toggle.contains(event.target)))||(this.burgerButtons&&Array.from(this.burgerButtons).some(button=>button.contains(event.target)));if(!isClickInside&&this.isOpen){this.toggleMenu()}}
handleEscKey(event){if(this.isOpen&&this.config.closeOnEsc&&event.key==='Escape'){this.toggleMenu()}}
handleFocusOut(event){if(event.relatedTarget&&!this.content.contains(event.relatedTarget)&&this.isOpen){this.toggleMenu()}}
bindEvents(){document.addEventListener('click',this.handleClickOutside);document.addEventListener('keydown',this.handleEscKey);this.content.addEventListener('focusout',this.handleFocusOut);if(this.burgerButtons){this.burgerButtons.forEach(burger=>{const scrollLock=parseFloat(burger.querySelector('button')?.getAttribute('data-scroll'))===1;if(scrollLock){this.hasScrollLock=!0}
burger.addEventListener('click',this.toggleMenu)})}}
manipulateTabIndexes(){this.manipulateTabIndex(this.content)}
destroy(){document.removeEventListener('click',this.handleClickOutside);document.removeEventListener('keydown',this.handleEscKey);this.content?.removeEventListener('focusout',this.handleFocusOut);if(this.config.customToggle){document.querySelectorAll(this.config.customToggle).forEach(toggle=>{toggle.removeEventListener('click',this.toggleMenu);toggle.removeEventListener('keydown',this.toggleMenu)})}
if(this.timeline){this.timeline.kill()}
if(this.observer){this.observer.disconnect()}
if(this.isOpen){this.menu.removeAttribute('data-open');document.querySelector('html')?.removeAttribute('dan-burger--body-toggled');window.lenisInstance?.start()}
if(this.content){this.content.style.pointerEvents='';this.content.style.opacity=''}
this.menu=null;this.content=null;this.burgerButtons=null;this.timeline=null;this.observer=null}}
function dancepad_overlay_menu(){NextOverlayMenu.destroyAll();document.querySelectorAll('.dan-overlay-menu').forEach(element=>{const instance=new NextOverlayMenu(element);NextOverlayMenu.instances.push(instance)})}