class DanInteractiveLines{static instances=[];constructor(selector,options={}){this.config={cell:options.cell,alpha:options.alpha,line:options.line,width:options.width,speed:options.speed,size:options.size,threshold:options.threshold,intensity:options.intensity,activeColor:options.activeColor,inactiveColor:options.inactiveColor,...options};this.DPR=window.devicePixelRatio||1;this.header=selector;this.lines=this.header.getElementsByTagName('canvas')[0];this.linesCtx=this.lines.getContext('2d');this.cells=[];this.sizeObserver=null;this.boundSyncLines=this.syncLines.bind(this);this.initializeLines();this.setupEventListeners();this.setupProperties()}
drawLines=()=>{this.linesCtx.clearRect(0,0,this.lines.width,this.lines.height);this.cells.forEach((cell)=>{this.linesCtx.save();this.linesCtx.translate(cell.x,cell.y);this.linesCtx.rotate(cell.a);this.linesCtx.beginPath();this.linesCtx.globalAlpha=this.config.alpha;this.linesCtx.lineWidth=this.config.width;const dx=(parseFloat(this.header.style.getPropertyValue('--mx'))||0)-cell.x;const dy=(parseFloat(this.header.style.getPropertyValue('--my'))||0)-cell.y;const distance=Math.sqrt(dx*dx+dy*dy);this.linesCtx.strokeStyle=distance<this.config.size?this.config.activeColor:this.config.inactiveColor;this.linesCtx.moveTo((this.config.cell*this.config.line*-1)/2,0);this.linesCtx.lineTo((this.config.cell*this.config.line)/2,0);this.linesCtx.stroke();this.linesCtx.restore()})}
initializeLines=()=>{const{width,height}=this.lines.getBoundingClientRect();this.lines.width=width*this.DPR;this.lines.height=height*this.DPR;this.linesCtx.scale(this.DPR,this.DPR);this.cells.length=0;for(let x=0;x<width;x+=this.config.cell){for(let y=0;y<height;y+=this.config.cell){this.cells.push({x:x+this.config.cell*0.5,y:y+this.config.cell*0.5,r:0,t:0,a:0})}}
gsap.ticker.add(this.drawLines)}
getShortestRotation=(current,target)=>{let diff=target-current;if(diff>Math.PI)diff-=2*Math.PI;if(diff<-Math.PI)diff+=2*Math.PI;return diff}
syncLines=({x,y})=>{const{left,top}=this.lines.getBoundingClientRect();this.header.style.setProperty('--mx',Math.floor(x-left));this.header.style.setProperty('--my',Math.floor(y-top));this.cells.forEach((cell)=>{const dx=x-(cell.x+left);const dy=y-(cell.y+top);const newAngle=Math.atan2(dy,dx);const diff=this.getShortestRotation(cell.a,newAngle);if(Math.abs(diff)>this.config.threshold){cell.a+=diff*this.config.speed;cell.a=((cell.a+Math.PI)%(2*Math.PI))-Math.PI}else{cell.a=newAngle}
cell.t=newAngle})}
setupEventListeners(){this.sizeObserver=new ResizeObserver(()=>this.initializeLines());this.sizeObserver.observe(this.lines);window.addEventListener('pointermove',this.boundSyncLines)}
setupProperties(){this.header.style.setProperty('--intensity',1-this.config.intensity);this.header.style.setProperty('--mask-size',this.config.size)}
destroy(){gsap.ticker.remove(this.drawLines);window.removeEventListener('pointermove',this.boundSyncLines);if(this.sizeObserver){this.sizeObserver.disconnect()}}
static destroyAllInstances(){DanInteractiveLines.instances.forEach((instance)=>instance.destroy());DanInteractiveLines.instances=[]}}
function dancepad_interactive_lines(){DanInteractiveLines.destroyAllInstances();document.querySelectorAll('.dan-interactive-lines').forEach(interactiveLines=>{const computedStyle=window.getComputedStyle(interactiveLines);const instance=new DanInteractiveLines(interactiveLines,{cell:parseFloat(interactiveLines.getAttribute('data-cell'))||40,alpha:parseFloat(interactiveLines.getAttribute('data-alpha'))||0.5,line:parseFloat(interactiveLines.getAttribute('data-line'))||1,width:parseFloat(interactiveLines.getAttribute('data-width'))||1,speed:parseFloat(interactiveLines.getAttribute('data-speed'))||0.1,size:parseFloat(interactiveLines.getAttribute('data-size'))||100,threshold:parseFloat(interactiveLines.getAttribute('data-threshold'))||0.1,intensity:parseFloat(interactiveLines.getAttribute('data-intensity'))||0.5,activeColor:computedStyle.getPropertyValue('--active-color').trim()||'#000000',inactiveColor:computedStyle.getPropertyValue('--inactive-color').trim()||'#666666',});DanInteractiveLines.instances.push(instance)})}