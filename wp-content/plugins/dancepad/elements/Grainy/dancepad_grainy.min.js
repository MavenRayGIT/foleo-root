class Grainy{constructor(element,options={}){this.element=element;this.speed=parseFloat(element.getAttribute('data-speed'));this.grainDimension=parseFloat(element.getAttribute('data-grain-dimensions'));this.frames=[];this.currentFrame=0;this.animationTimeout=null;this.canvas=this.element.querySelector('#dan-noise');this.ctx=this.canvas.getContext('2d');this.init()}
static instances=[];static destroyAll(){Grainy.instances.forEach(instance=>instance.destroy());Grainy.instances=[]}
calculateDimensions(){let width,height;if(this.grainDimension){if(this.grainDimension==="window"){width=window.innerWidth;height=window.innerHeight}else{const dimension=parseFloat(this.grainDimension);width=height=Math.min(dimension,4000)}}
return{width,height}}
createFrame(){const{width,height}=this.calculateDimensions();const imageData=this.ctx.createImageData(width,height);const pixels=new Uint32Array(imageData.data.buffer);for(let i=0;i<pixels.length;i++){if(Math.random()<0.5){pixels[i]=4278190080}}
return imageData}
updateFrame(){this.currentFrame=this.currentFrame===9?0:this.currentFrame+1;this.ctx.putImageData(this.frames[this.currentFrame],0,0)}
animate(){this.updateFrame();this.animationTimeout=window.setTimeout(()=>{window.requestAnimationFrame(this.animate.bind(this))},1000/this.speed)}
init(){const{width,height}=this.calculateDimensions();this.canvas.width=width;this.canvas.height=height;for(let i=0;i<10;i++){this.frames.push(this.createFrame())}
this.animate()}
destroy(){if(this.animationTimeout){clearTimeout(this.animationTimeout)}
if(this.ctx){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}
this.frames=[]}}
function dancepad_grainy(){Grainy.destroyAll();const elements=document.querySelectorAll('.dan-grainy');elements.forEach(element=>{element.removeAttribute('data-flickering');element.removeAttribute('dan-grainy__to-hide');const instance=new Grainy(element);Grainy.instances.push(instance)})}