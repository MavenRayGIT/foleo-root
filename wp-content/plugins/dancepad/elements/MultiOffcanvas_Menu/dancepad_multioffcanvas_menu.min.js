class NextMultiOffcanvasMenu{constructor(element){this.menu=element;this.itemsWrapper=element.querySelector('.dan-multi-offcanvas-menu__items-wrapper');this.backdrop=element.querySelector('.dan-multi-offcanvas-menu__backdrop');this.mainBurgers=element.querySelectorAll('.dan-burger:not(.dan-multi-offcanvas-menu__subcanvas .dan-burger)');this.subcanvasBurgers=element.querySelectorAll('.dan-multi-offcanvas-menu__subcanvas .dan-burger');this.subcanvases=element.querySelectorAll('.dan-multi-offcanvas-menu__subcanvas');this.isOpen=!1;this.hasScrollLock=!1;this.observer=null;this.config=this.initConfig();this.bindMethods();this.init()}
static instances=[];static destroyAll(){NextMultiOffcanvasMenu.instances.forEach(instance=>instance.destroy());NextMultiOffcanvasMenu.instances=[]}
bindMethods(){this.toggleMenu=this.toggleMenu.bind(this);this.handleBackdropClick=this.handleBackdropClick.bind(this);this.handleEscKey=this.handleEscKey.bind(this);this.handleSubcanvasToggle=this.handleSubcanvasToggle.bind(this);this.handleSubcanvasFocusOut=this.handleSubcanvasFocusOut.bind(this)}
initConfig(){return{customToggle:this.menu.getAttribute('data-customtoggle'),closeOnEsc:this.menu.getAttribute('data-close-on-esc')==='1',toggleBodyScroll:this.menu.getAttribute('data-customtoggle-lock-body-scrolling')==='1'}}
init(){if(!this.itemsWrapper)return;this.setupCustomToggles();this.setupSubcanvases();this.bindEvents();this.setupMutationObserver();this.manipulateTabIndexes()}
setupMutationObserver(){this.observer=new MutationObserver(mutations=>{mutations.forEach(mutation=>{if(mutation.type==='childList'){mutation.addedNodes.forEach(node=>{if(node.nodeType===Node.ELEMENT_NODE){this.applyTabIndexRecursively(node)}})}})});this.observer.observe(this.itemsWrapper,{childList:!0,subtree:!0})}
setupSubcanvases(){this.subcanvases.forEach((subcanvas,index)=>{const openToggle=subcanvas.getAttribute('data-opentoggle');const closeToggle=subcanvas.getAttribute('data-closetoggle');if(openToggle===closeToggle&&openToggle){this.setupToggleSubcanvas(subcanvas,openToggle,index)}else{if(openToggle)this.setupOpenSubcanvas(subcanvas,openToggle,index);if(closeToggle)this.setupCloseSubcanvas(subcanvas,closeToggle);}})}
setupToggleSubcanvas(subcanvas,toggleSelector,index){const toggles=document.querySelectorAll(toggleSelector);toggles.forEach(toggle=>{this.setupMenuAttributeObserver(toggle);toggle.addEventListener('mousedown',(event)=>{event.preventDefault();this.handleSubcanvasToggle(subcanvas,index,!0)});toggle.addEventListener('keydown',(event)=>{if(event.key==='Enter'){this.handleSubcanvasToggle(subcanvas,index,!1);this.focusFirstInteractive(subcanvas)}});subcanvas.addEventListener('focusout',()=>toggle.focus())})}
setupOpenSubcanvas(subcanvas,openSelector,index){const openers=document.querySelectorAll(openSelector);openers.forEach(opener=>{this.setupMenuAttributeObserver(opener);opener.addEventListener('mousedown',(event)=>{event.preventDefault();this.openSubcanvas(subcanvas,index)});opener.addEventListener('keydown',(event)=>{if(event.key==='Enter'){this.openSubcanvas(subcanvas,index);this.focusFirstInteractive(subcanvas)}});subcanvas.addEventListener('focusout',()=>opener.focus())})}
setupCloseSubcanvas(subcanvas,closeSelector){const closers=document.querySelectorAll(closeSelector);closers.forEach(closer=>{this.setupMenuAttributeObserver(closer);closer.addEventListener('mousedown',(event)=>{event.preventDefault();this.closeAllSubcanvases()});closer.addEventListener('keydown',(event)=>{if(event.key==='Enter'){this.closeAllSubcanvases()}})})}
setupMenuAttributeObserver(element){new MutationObserver(mutations=>{mutations.forEach(mutation=>{if(mutation.type==='attributes'&&mutation.attributeName==='data-open'&&this.menu.getAttribute('data-open')==='dan-multi-offcanvas-menu--opened'){if(!element.classList.contains('dan-burger')){element.setAttribute('tabindex','0')}}})}).observe(this.menu,{attributes:!0,attributeOldValue:!0})}
setupCustomToggles(){if(!this.config.customToggle)return;const toggles=document.querySelectorAll(this.config.customToggle);toggles.forEach(toggle=>{if(!toggle.hasAttribute('tabindex')){toggle.setAttribute('tabindex','0')}
toggle.addEventListener('click',()=>{this.toggleBodyScroll();this.toggleMenu()});toggle.addEventListener('keydown',(event)=>{if(event.key==='Enter'){this.toggleBodyScroll();this.toggleMenu();event.stopImmediatePropagation()}})})}
toggleMenu(){this.isOpen=!this.isOpen;this.manipulateTabIndex(this.itemsWrapper);if(this.isOpen){this.itemsWrapper.style.pointerEvents='all';this.menu.setAttribute('data-open','dan-multi-offcanvas-menu--opened')}else{this.itemsWrapper.style.pointerEvents='none';this.menu.removeAttribute('data-open');this.itemsWrapper.removeAttribute('data-open');const html=document.querySelector('html');if(html?.hasAttribute('dan-burger--body-toggled')){html.removeAttribute('dan-burger--body-toggled');window.lenisInstance?.start()}}
this.updateMainBurgers();this.updateCustomToggles();this.closeAllSubcanvases()}
updateMainBurgers(){this.mainBurgers.forEach(burger=>this.updateBurgerToggle(burger,this.isOpen))}
updateCustomToggles(){if(!this.config.customToggle)return;const toggleClassName=this.config.customToggle.replace('.','');const allBurgers=document.querySelectorAll('.dan-burger');allBurgers.forEach(burger=>{if(!this.menu.contains(burger)&&burger.classList.contains(toggleClassName)){this.updateBurgerToggle(burger,this.isOpen)}})}
updateBurgerToggle(burger,isOpen){const button=burger.querySelector('button');if(!button)return;const existingClasses=Array.from(button.classList);existingClasses.forEach(className=>{if(className.includes('--opened')){button.classList.remove(className)}});if(isOpen){const baseClasses=existingClasses.filter(className=>(className.startsWith('dan-burger-')||className.startsWith('hamburger--'))&&!className.includes('--opened'));baseClasses.forEach(baseClass=>{button.classList.add(`${baseClass}--opened`)})}
button.setAttribute('aria-expanded',isOpen?'true':'false')}
handleSubcanvasToggle(subcanvas,index,isMouseEvent){const isSubcanvasOpen=subcanvas.hasAttribute('data-open');this.closeOtherSubcanvases(index);if(this.itemsWrapper.hasAttribute('data-open')){if(isSubcanvasOpen){this.itemsWrapper.toggleAttribute('data-open')}}else{this.itemsWrapper.toggleAttribute('data-open')}
subcanvas.toggleAttribute('data-open');this.updateSubcanvasBurgers(subcanvas)}
openSubcanvas(subcanvas,index){this.closeOtherSubcanvases(index);if(!this.itemsWrapper.hasAttribute('data-open')){this.itemsWrapper.toggleAttribute('data-open')}
if(!subcanvas.hasAttribute('data-open')){subcanvas.toggleAttribute('data-open')}
this.updateSubcanvasBurgers(subcanvas)}
closeAllSubcanvases(){this.subcanvases.forEach(subcanvas=>{if(subcanvas.hasAttribute('data-open')){subcanvas.toggleAttribute('data-open')}})}
closeOtherSubcanvases(currentIndex){this.subcanvases.forEach((subcanvas,index)=>{if(index!==currentIndex&&subcanvas.hasAttribute('data-open')){subcanvas.toggleAttribute('data-open')}})}
updateSubcanvasBurgers(targetSubcanvas){this.subcanvasBurgers.forEach(burger=>{let currentElement=burger;while(currentElement!==targetSubcanvas&&currentElement.parentNode){currentElement=currentElement.parentNode}
this.updateBurgerToggle(burger,currentElement===targetSubcanvas)})}
focusFirstInteractive(element){const focusableElements=element.querySelectorAll('a, button, [tabindex="0"], [contenteditable="true"], input, select, textarea');if(focusableElements.length>0){focusableElements[0].focus()}}
toggleBodyScroll(){const shouldToggleScroll=this.config.toggleBodyScroll||this.hasScrollLock;if(!shouldToggleScroll)return;const html=document.querySelector('html');if(html.hasAttribute('dan-burger--body-toggled')){window.lenisInstance?.start();html.removeAttribute('dan-burger--body-toggled')}else{window.lenisInstance?.stop();html.setAttribute('dan-burger--body-toggled','')}}
handleBackdropClick(){if(this.isOpen){this.toggleMenu();if(this.config.toggleBodyScroll||this.hasScrollLock){document.querySelector('html')?.removeAttribute('dan-burger--body-toggled');window.lenisInstance?.start()}}}
handleEscKey(event){if(this.isOpen&&this.config.closeOnEsc&&event.key==='Escape'){this.toggleMenu();if(this.config.toggleBodyScroll||this.hasScrollLock){document.querySelector('html')?.removeAttribute('dan-burger--body-toggled');window.lenisInstance?.start()}}}
handleSubcanvasFocusOut(event){if(event.relatedTarget&&!this.itemsWrapper.contains(event.relatedTarget)&&this.isOpen){this.toggleMenu()}}
manipulateTabIndex(element){if(element.hasAttribute('tabindex')&&element.getAttribute('tabindex')==='-1'){element.removeAttribute('tabindex')}else{element.setAttribute('tabindex','-1')}
Array.from(element.children).forEach(child=>this.manipulateTabIndex(child))}
applyTabIndexRecursively(element){if(element.nodeType===Node.ELEMENT_NODE){if(!element.hasAttribute('tabindex')||element.getAttribute('tabindex')!=='-1'){element.setAttribute('tabindex','-1')}
Array.from(element.children).forEach(child=>this.applyTabIndexRecursively(child))}}
bindEvents(){document.addEventListener('keydown',this.handleEscKey);this.backdrop?.addEventListener('click',this.handleBackdropClick);this.itemsWrapper?.addEventListener('focusout',this.handleSubcanvasFocusOut);this.mainBurgers.forEach(burger=>{const button=burger.querySelector('button');const scrollLock=parseFloat(button?.getAttribute('data-scroll'))===1;if(scrollLock){this.hasScrollLock=!0}
burger.addEventListener('click',this.toggleMenu)})}
manipulateTabIndexes(){if(this.itemsWrapper){this.manipulateTabIndex(this.itemsWrapper)}}
destroy(){document.removeEventListener('keydown',this.handleEscKey);this.backdrop?.removeEventListener('click',this.handleBackdropClick);this.itemsWrapper?.removeEventListener('focusout',this.handleSubcanvasFocusOut);this.mainBurgers.forEach(burger=>{burger.removeEventListener('click',this.toggleMenu)});if(this.config.customToggle){document.querySelectorAll(this.config.customToggle).forEach(toggle=>{toggle.removeEventListener('click',this.toggleMenu);toggle.removeEventListener('keydown',this.toggleMenu)})}
if(this.observer){this.observer.disconnect()}
if(this.isOpen){this.menu.removeAttribute('data-open');document.querySelector('html')?.removeAttribute('dan-burger--body-toggled');window.lenisInstance?.start()}
if(this.itemsWrapper){this.itemsWrapper.style.pointerEvents=''}
this.subcanvases.forEach(subcanvas=>{if(subcanvas.hasAttribute('data-open')){subcanvas.removeAttribute('data-open')}});this.menu=null;this.itemsWrapper=null;this.backdrop=null;this.mainBurgers=null;this.subcanvasBurgers=null;this.subcanvases=null;this.observer=null}}
function dancepad_multioffcanvas_menu(){NextMultiOffcanvasMenu.destroyAll();document.querySelectorAll('.dan-multi-offcanvas-menu').forEach(element=>{const instance=new NextMultiOffcanvasMenu(element);NextMultiOffcanvasMenu.instances.push(instance)})}