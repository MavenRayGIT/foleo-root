class Stories{static instances=[];static observer=null;constructor(container){this.container=container;this.elements=container.querySelectorAll('.dan-stories__story');this.controls=container.querySelector('.dan-stories__controls');this.thumbContainer=this.controls.querySelector('.dan-stories__controls-thumb');this.duration=parseFloat(container.getAttribute("data-duration"))*1000;this.ease=container.getAttribute("data-ease")||'none';this.timeout=null;this.pausedTimeout=null;this.index=0;this.slide=this.elements[this.index];this.paused=!1;this.thumbItems=null;this.thumb=null;this.elements.forEach(el=>el.setAttribute('inert',''));this.init()}
init(){this.createThumbs();this.addControls();this.show(this.index)}
createThumbs(){this.thumbContainer.innerHTML='';this.elements.forEach(()=>{const span=document.createElement('span');const thumb=document.createElement('span');thumb.classList.add('thumb-item');span.appendChild(thumb);this.thumbContainer.appendChild(span)});this.thumbItems=Array.from(this.thumbContainer.querySelectorAll('.thumb-item'))}
addControls(){const btnPrev=document.createElement('button');const btnNext=document.createElement('button');btnPrev.addEventListener('keydown',e=>{if(e.key==='Enter')this.prev();});btnNext.addEventListener('keydown',e=>{if(e.key==='Enter')this.next();});btnPrev.addEventListener('pointerup',()=>this.prev());btnNext.addEventListener('pointerup',()=>this.next());this.controls.appendChild(btnPrev);this.controls.appendChild(btnNext);this.controls.addEventListener('pointerdown',()=>this.pause());document.addEventListener('pointerup',()=>this.continue());document.addEventListener('touchend',()=>this.continue())}
hide(el){el.classList.remove('active');const video=el.querySelector('video');if(video){video.pause();video.muted=!0;video.currentTime=0}}
show(index){this.index=index;this.slide=this.elements[this.index];if(this.thumbItems){this.thumb=this.thumbItems[this.index];this.thumbItems.forEach(t=>t.classList.remove('active'));this.thumb.classList.add('active')}
this.elements.forEach(el=>this.hide(el));this.slide.classList.add('active');if(this.thumb){const duration=this.slide.querySelector('video')?this.slide.querySelector('video').duration:this.duration/1000;if(!this.thumb.timeline){this.thumb.timeline=gsap.timeline({paused:!0});this.thumb.timeline.fromTo(this.thumb,{x:'-100%'},{x:'0%',duration:duration,ease:this.ease})}
this.thumb.timeline.restart()}
const video=this.slide.querySelector('video');if(video){video.controls=!1;video.currentTime=0;video.play();this.auto(video.duration*1000);this.controls.addEventListener('pointerdown',()=>{video.pause();if(this.thumb?.timeline)this.thumb.timeline.pause();});this.controls.addEventListener('pointerup',()=>{video.play();if(this.thumb?.timeline)this.thumb.timeline.play();})}else{this.auto(this.duration)}}
auto(ms){if(this.timeout)this.timeout.clear();this.timeout=new StoriesTimeout(()=>this.next(),ms)}
next(){if(!this.paused){const nextIndex=this.index+1<this.elements.length?this.index+1:0;this.show(nextIndex)}}
prev(){if(!this.paused){const prevIndex=this.index-1>=0?this.index-1:this.elements.length-1;this.show(prevIndex)}}
pause(){window.oncontextmenu=()=>!1;this.pausedTimeout=new StoriesTimeout(()=>{this.paused=!0;this.timeout?.pause();this.thumb?.classList.add("paused");if(this.thumb?.timeline)this.thumb.timeline.pause();const video=this.slide.querySelector('video');if(video)video.pause();},300)}
continue(){this.pausedTimeout?.clear();if(this.paused){this.paused=!1;this.timeout?.continue();this.thumb?.classList.remove("paused");if(this.thumb?.timeline)this.thumb.timeline.play();const video=this.slide.querySelector('video');if(video)video.play();}}
destroy(){this.timeout?.clear();this.pausedTimeout?.clear();this.thumbItems?.forEach(thumb=>{if(thumb.timeline){thumb.timeline.kill();thumb.removeAttribute('style')}})}
static destroyAllInstances(){Stories.instances.forEach(instance=>instance.destroy());Stories.instances=[]}
static initMutationObserver(){if(Stories.observer){Stories.observer.disconnect()}
Stories.observer=new MutationObserver((mutations)=>{let shouldReinitialize=!1;mutations.forEach((mutation)=>{if(mutation.type==='childList'){mutation.addedNodes.forEach((node)=>{if(node.nodeType===Node.ELEMENT_NODE){if(node.classList&&node.classList.contains('dan-stories__story')){shouldReinitialize=!0}else if(node.querySelector&&node.querySelector('.dan-stories__story')){shouldReinitialize=!0}}});mutation.removedNodes.forEach((node)=>{if(node.nodeType===Node.ELEMENT_NODE){if(node.classList&&node.classList.contains('dan-stories__story')){shouldReinitialize=!0}else if(node.querySelector&&node.querySelector('.dan-stories__story')){shouldReinitialize=!0}}})}});if(shouldReinitialize){setTimeout(()=>{dancepad_stories()},100)}});document.querySelectorAll('.dan-stories').forEach(container=>{const elementsContainer=container.querySelector('.dan-stories__container');if(elementsContainer){Stories.observer.observe(elementsContainer,{childList:!0,subtree:!0})}})}}
class StoriesTimeout{constructor(handler,duration){this.handler=handler;this.timeLeft=duration;this.id=setTimeout(handler,duration);this.start=Date.now()}
clear(){clearTimeout(this.id)}
pause(){const elapsed=Date.now()-this.start;this.timeLeft-=elapsed;this.clear()}
continue(){this.clear();this.id=setTimeout(this.handler,this.timeLeft);this.start=Date.now()}}
function dancepad_stories(){Stories.destroyAllInstances();const isBreakdance=window.location.href.includes("breakdance");document.querySelectorAll('.dan-stories').forEach(container=>{container.removeAttribute('data-flickering');if(isBreakdance&&container.getAttribute('data-disable-builder')?.includes('1'))return;const elements=container.querySelector('.dan-stories__container');const controls=container.querySelector('.dan-stories__controls');const stories=elements.querySelectorAll('.dan-stories__story');if(container&&elements&&controls&&stories.length){const instance=new Stories(container);Stories.instances.push(instance)}});Stories.initMutationObserver()}