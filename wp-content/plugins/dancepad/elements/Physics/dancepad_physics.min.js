class PhysicsElement{constructor(element){this.element=element;this.isPreview=window.location.search.includes("breakdance_iframe");this.engine=null;this.renderer=null;this.physicsCreated=!1;this.windowWidth=jQuery(window).width();this.config=this.initConfig();this.bindEvents()}
static instances=[];static destroyAll(){PhysicsElement.instances.forEach(instance=>instance.destroy());PhysicsElement.instances=[]}
initConfig(){const elementStyles=getComputedStyle(this.element);return{gravity:{horizontal:parseFloat(this.element.getAttribute('data-gravity-horizontal')),vertical:parseFloat(this.element.getAttribute('data-gravity-vertical'))},timeScale:parseFloat(this.element.getAttribute('data-time-scale')),wireframes:this.element.getAttribute('data-wireframes')==='1',stiffness:parseFloat(this.element.getAttribute('data-stiffness')),walls:{enable:{top:this.element.getAttribute('data-enable-top-wall')==='1',bottom:this.element.getAttribute('data-enable-bottom-wall')==='1',left:this.element.getAttribute('data-enable-left-wall')==='1',right:this.element.getAttribute('data-enable-right-wall')==='1'},visible:this.element.getAttribute('data-wall-visible')==='1',width:parseFloat(this.element.getAttribute('data-wall-width')),fillStyle:elementStyles.getPropertyValue('--fill-wall').trim()},trigger:{element:this.element.getAttribute('data-trigger')==='this'?this.element:this.element.getAttribute('data-trigger'),start:this.element.getAttribute('data-start')}}}
parseElementsData(){const elementsData=this.element.querySelector('.dan-elements-list');const attributes=['shape','horizontal','vertical','width','height','radius-circle','radius-polygon','sides','border-radius','image-url','image-scale','fill','stroke-color','stroke-width','static','restitution','friction','friction-air','density','links','links-tabs'];return attributes.reduce((acc,attr)=>{acc[attr]=elementsData.getAttribute(`data-${attr}`).split('d4511782').map(value=>value.trim()).filter(value=>value!=='');return acc},{})}
createShape(data,index){const{Matter:{Bodies}}=window;const horizontal=data.horizontal[index].includes('%')?(parseFloat(data.horizontal[index])/100)*this.element.clientWidth:parseFloat(data.horizontal[index]);const vertical=data.vertical[index].includes('%')?(parseFloat(data.vertical[index])/100)*this.element.clientHeight:parseFloat(data.vertical[index]);let varLink="";if(data.links[index]!=='unset'){varLink={url:data.links[index],target:data['links-tabs'][index]==='1'?'_blank':''}}
const commonOptions={isStatic:data.static[index]==='1',restitution:parseFloat(data.restitution[index]),friction:parseFloat(data.friction[index]),frictionAir:parseFloat(data['friction-air'][index]),density:parseFloat(data.density[index]),chamfer:{radius:parseFloat(data['border-radius'][index])},render:{visible:!0,sprite:{texture:data['image-url'][index]!=='unset'?data['image-url'][index]:'',xScale:parseFloat(data['image-scale'][index]),yScale:parseFloat(data['image-scale'][index])},fillStyle:data.fill[index],lineWidth:parseFloat(data['stroke-width'][index]),strokeStyle:data['stroke-color'][index]},customLink:varLink};switch(data.shape[index]){case 'rectangle':return Bodies.rectangle(horizontal,vertical,parseFloat(data.width[index]),parseFloat(data.height[index]),commonOptions);case 'circle':return Bodies.circle(horizontal,vertical,parseFloat(data['radius-circle'][index]),commonOptions);case 'polygon':return Bodies.polygon(horizontal,vertical,parseFloat(data.sides[index]),parseFloat(data['radius-polygon'][index]),commonOptions);default:return null}}
setupMouseControl(){const{Matter:{MouseConstraint,World}}=window;const mouseControl=MouseConstraint.create(this.engine,{element:this.element,constraint:{stiffness:this.config.stiffness,render:{visible:!1}}});const mouseElement=mouseControl.mouse.element;mouseElement.removeEventListener('mousewheel',mouseControl.mouse.mousewheel);mouseElement.removeEventListener('DOMMouseScroll',mouseControl.mouse.mousewheel);mouseElement.removeEventListener('touchstart',mouseControl.mouse.mousedown);mouseElement.removeEventListener('touchmove',mouseControl.mouse.mousemove);mouseElement.removeEventListener('touchend',mouseControl.mouse.mouseup);mouseElement.addEventListener('touchstart',mouseControl.mouse.mousedown,{passive:!0});mouseElement.addEventListener('touchmove',(e)=>{if(mouseControl.body){mouseControl.mouse.mousemove(e)}});mouseElement.addEventListener('touchend',(e)=>{if(mouseControl.body){mouseControl.mouse.mouseup(e)}});World.add(this.engine.world,[mouseControl])}
createWalls(){const{Matter:{Bodies,World}}=window;const wallOptions={isStatic:!0,render:{visible:this.config.walls.visible,fillStyle:this.config.walls.fillStyle}};const walls=[];const width=this.element.clientWidth;const height=this.element.clientHeight;if(this.config.walls.enable.top){walls.push(Bodies.rectangle(width/2,0,width,this.config.walls.width,wallOptions))}
if(this.config.walls.enable.bottom){walls.push(Bodies.rectangle(width/2,height,width,this.config.walls.width,wallOptions))}
if(this.config.walls.enable.left){walls.push(Bodies.rectangle(0,height/2,this.config.walls.width,height,wallOptions))}
if(this.config.walls.enable.right){walls.push(Bodies.rectangle(width,height/2,this.config.walls.width,height,wallOptions))}
World.add(this.engine.world,walls)}
createPhysics(){const{Matter:{Engine,Render,World}}=window;this.engine=Engine.create({gravity:{x:this.config.gravity.horizontal,y:this.config.gravity.vertical},timing:{timeScale:this.config.timeScale}});this.renderer=Render.create({element:this.element,engine:this.engine,canvas:this.element.querySelector('#dan-physics-canvas'),options:{width:this.element.clientWidth,height:this.element.clientHeight,wireframes:this.config.wireframes,pixelRatio:window.devicePixelRatio}});const elementsData=this.parseElementsData();elementsData.shape.forEach((_,index)=>{const shape=this.createShape(elementsData,index);if(shape){World.add(this.engine.world,[shape])}});this.setupMouseControl();this.createWalls();Matter.Runner.run(this.engine);Render.run(this.renderer);this.element.removeAttribute('data-flickering');this.element.addEventListener('click',(event)=>{const bounds=this.element.getBoundingClientRect();const click={x:event.clientX-bounds.left,y:event.clientY-bounds.top};const bodies=Matter.Composite.allBodies(this.engine.world);bodies.forEach(body=>{if(Matter.Bounds.contains(body.bounds,click)&&Matter.Vertices.contains(body.vertices,click)&&body.customLink){if(body.customLink.target==='_blank'){window.open(body.customLink.url,'_blank')}else{window.location.href=body.customLink.url}}})})}
clearPhysics(){if(!this.engine||!this.renderer)return;const{Matter:{World,Engine,Render}}=window;Render.stop(this.renderer);World.clear(this.engine.world);Engine.clear(this.engine);if(this.renderer.canvas){const ctx=this.renderer.canvas.getContext('2d');ctx.clearRect(0,0,this.renderer.canvas.width,this.renderer.canvas.height);this.renderer.context=null;this.renderer.textures={}}}
handleResize=()=>{const currentWidth=jQuery(window).width();if(currentWidth!==this.windowWidth){this.windowWidth=currentWidth;this.clearPhysics();this.createPhysics()}}
bindEvents(){window.addEventListener('resize',this.handleResize);document.querySelectorAll('.dan-tabs__tab').forEach(tab=>{tab.addEventListener('click',()=>{setTimeout(()=>{this.clearPhysics();this.createPhysics()},50)})});ScrollTrigger.create({trigger:this.config.trigger.element,start:this.config.trigger.start,onEnter:()=>{if(!this.physicsCreated){this.createPhysics();this.physicsCreated=!0}}})}
destroy(){this.clearPhysics();window.removeEventListener('resize',this.handleResize);this.element=null}}
function dancepad_physics(){document.querySelectorAll('.dan-physics').forEach(element=>{const instance=new PhysicsElement(element);PhysicsElement.instances.push(instance)})}