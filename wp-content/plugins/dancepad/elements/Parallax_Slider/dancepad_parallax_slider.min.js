class ParallaxUtils{static constants={isDevice:'ontouchstart' in window};static lerp(a,b,n){return(1-n)*a+n*b}
static clamp(val,min,max){return Math.max(Math.min(val,max),min)}}
class ScrollHandler{constructor(element,options={}){this.dom={container:element.querySelector('[data-parallax-slider-scroll]')};this.options={ease:options.scrollEase,dragSpeed:options.dragSpeed,scrollMultiplier:options.scrollMultiplier,parallaxScale:options.parallaxScale};this.state={bounds:{},current:0,last:0,dragStart:0,dragEnd:0,dragging:!1};this.init()}
smooth=()=>{this.state.last=ParallaxUtils.lerp(this.state.last,this.state.current,this.options.ease);this.dom.container.style.transform=`translate3d(${this.state.last}px, 0, 0)`};calc=(delta)=>{this.state.current=this.state.current+delta;this.state.current=ParallaxUtils.clamp(this.state.current,(this.state.bounds.width-window.innerWidth)*-1,0)};handleWheel=(e)=>{e.preventDefault();this.calc(e.deltaY*this.options.scrollMultiplier)};handleTouchStart=(e)=>{this.state.dragging=!0;this.state.dragStart=e.touches[0].clientX;this.state.dragEnd=this.state.current;document.body.classList.add('is-dragging')};handleTouchMove=(e)=>{if(!this.state.dragging)return;const x=e.touches[0].clientX;const delta=(this.state.dragStart-x)*this.options.dragSpeed;this.state.current=this.state.dragEnd-delta;this.state.current=ParallaxUtils.clamp(this.state.current,(this.state.bounds.width-window.innerWidth)*-1,0);if(Math.abs(delta)>5){e.preventDefault()}};handleTouchEnd=()=>{this.state.dragging=!1;this.state.dragEnd=this.state.current;document.body.classList.remove('is-dragging')};handleMousedown=(e)=>{this.state.dragging=!0;this.state.dragStart=e.clientX;this.state.dragEnd=this.state.current;document.body.classList.add('is-dragging')};handleMousemove=(e)=>{if(!this.state.dragging)return;const delta=(this.state.dragStart-e.clientX)*this.options.dragSpeed;this.state.current=this.state.dragEnd-delta;this.state.current=ParallaxUtils.clamp(this.state.current,(this.state.bounds.width-window.innerWidth)*-1,0)};handleMouseup=()=>{this.state.dragging=!1;this.state.dragEnd=this.state.current;document.body.classList.remove('is-dragging')};handleMouseleave=()=>{this.state.dragging=!1;this.state.dragEnd=this.state.current;document.body.classList.remove('is-dragging')};handleResize=()=>{this.state.bounds=this.dom.container.getBoundingClientRect()};enable(){gsap.ticker.add(this.smooth);this.dom.container.addEventListener('touchstart',this.handleTouchStart,{passive:!0});this.dom.container.addEventListener('touchmove',this.handleTouchMove,{passive:!1});this.dom.container.addEventListener('touchend',this.handleTouchEnd);if(!ParallaxUtils.constants.isDevice){this.dom.container.addEventListener('wheel',this.handleWheel,{passive:!1});this.dom.container.addEventListener('mousedown',this.handleMousedown);this.dom.container.addEventListener('mousemove',this.handleMousemove);this.dom.container.addEventListener('mouseup',this.handleMouseup);this.dom.container.addEventListener('mouseleave',this.handleMouseleave)}}
disable(){gsap.ticker.remove(this.smooth);this.dom.container.removeEventListener('touchstart',this.handleTouchStart);this.dom.container.removeEventListener('touchmove',this.handleTouchMove);this.dom.container.removeEventListener('touchend',this.handleTouchEnd);if(!ParallaxUtils.constants.isDevice){this.dom.container.removeEventListener('wheel',this.handleWheel);this.dom.container.removeEventListener('mousedown',this.handleMousedown);this.dom.container.removeEventListener('mousemove',this.handleMousemove);this.dom.container.removeEventListener('mouseup',this.handleMouseup);this.dom.container.removeEventListener('mouseleave',this.handleMouseleave)}}
addListeners(){window.addEventListener('resize',this.handleResize,{passive:!0})}
removeListeners(){window.removeEventListener('resize',this.handleResize)}
init(){this.handleResize();this.enable();this.addListeners()}
destroy(){this.disable();this.removeListeners()}}
class SliderHandler{constructor(element,scrollInstance,options={}){this.dom={container:element.querySelector('.dan-parallax-slider__container'),items:element.querySelectorAll('.dan-parallax-slider__item'),images:element.querySelectorAll('.dan-parallax-slider__item-img-wrap'),progressWrap:element.querySelector('.dan-parallax-slider__progress-line-wrap'),progress:element.querySelector('.dan-parallax-slider__progress-line')};this.parallaxScale=options.parallaxScale;this.scrollInstance=scrollInstance;this.state={open:!0,scrollEnabled:!0,progress:0};this.items=[]}
setCache(){this.items=[];[...this.dom.items].forEach(el=>{const bounds=el.getBoundingClientRect();this.items.push({img:el.querySelector('.breakdance-image-object'),bounds,x:0})})}
render=()=>{const scrollLast=Math.abs(this.scrollInstance.state.last);this.items.forEach(item=>{const{bounds}=item;const inView=scrollLast+window.innerWidth>=bounds.left&&scrollLast<bounds.right;if(inView){const min=bounds.left-window.innerWidth;const max=bounds.right;const percentage=((scrollLast-min)*100)/(max-min);const newMin=-(window.innerWidth/12)*3;const newMax=0;item.x=((percentage-0)/(100-0))*(newMax-newMin)+newMin;if(item.img){item.img.style.transform=`translate3d(${item.x}px, 0, 0) scale(${this.parallaxScale})`}}});if(this.state.scrollEnabled&&this.dom.progress){const min=0;const max=-this.scrollInstance.state.bounds.width+window.innerWidth;this.state.progress=((this.scrollInstance.state.last-min)*100)/(max-min)/100;this.dom.progress.style.transform=`scaleX(${this.state.progress})`}};handleResize=()=>{this.setCache()};addListeners(){window.addEventListener('resize',this.handleResize)}
removeListeners(){window.removeEventListener('resize',this.handleResize)}
init(){gsap.ticker.add(this.render);this.setCache();this.addListeners()}
destroy(){gsap.ticker.remove(this.render);this.removeListeners()}}
class ParallaxSlider{constructor(element){this.element=element;this.scrollHandler=null;this.sliderHandler=null;this.observer=null;this.config={scrollEase:parseFloat(element.getAttribute('data-scroll-ease')),dragSpeed:parseFloat(element.getAttribute('data-drag-speed')),scrollMultiplier:parseFloat(element.getAttribute('data-scroll-multiplier')),parallaxScale:parseFloat(element.getAttribute('data-parallax-scale'))};this.init()}
static instances=[];static destroyAll(){ParallaxSlider.instances.forEach(instance=>instance.destroy());ParallaxSlider.instances=[]}
initSlider(){this.setInitialSlides();this.scrollHandler=new ScrollHandler(this.element,{scrollEase:this.config.scrollEase,dragSpeed:this.config.dragSpeed,scrollMultiplier:this.config.scrollMultiplier,parallaxScale:this.config.parallaxScale});this.sliderHandler=new SliderHandler(this.element,this.scrollHandler,{parallaxScale:this.config.parallaxScale});this.sliderHandler.init()}
setInitialSlides(){const items=this.element.querySelectorAll('.dan-parallax-slider__item');const sliderElement=this.element.querySelector('.dan-parallax-slider__slider');sliderElement.style.setProperty('--slidesTotal',items.length)}
setupObserver(){if(window.location.href.includes('breakdance_iframe')){this.observer=new MutationObserver(mutations=>{mutations.forEach(mutation=>{if(mutation.type==='childList'){const shouldReinitialize=[...mutation.addedNodes,...mutation.removedNodes].some(node=>node.nodeType===Node.ELEMENT_NODE&&node.classList.contains('dan-parallax-slider__item'));if(shouldReinitialize){this.reinitialize()}}})});this.observer.observe(this.element,{childList:!0,subtree:!0})}}
reinitialize(){this.destroy();this.initSlider()}
init(){if(ParallaxUtils.constants.isDevice){document.body.classList.add('is-device')}
this.element.removeAttribute('data-flickering');this.initSlider();this.setupObserver()}
destroy(){if(this.observer){this.observer.disconnect()}
if(this.scrollHandler){this.scrollHandler.destroy()}
if(this.sliderHandler){this.sliderHandler.destroy()}
this.element=null;this.scrollHandler=null;this.sliderHandler=null;this.observer=null}}
function dancepad_parallax_slider(){ParallaxSlider.destroyAll();document.querySelectorAll('.dan-parallax-slider').forEach(element=>{const instance=new ParallaxSlider(element);ParallaxSlider.instances.push(instance)});initializeParallaxSliderObserver()}
function initializeParallaxSliderObserver(){const breakdanceCanvas=document.querySelector('#breakdance_canvas');if(!breakdanceCanvas)return;const observer=new MutationObserver((mutations)=>{for(const mutation of mutations){if(mutation.type==='childList'){const hasChanges=[...mutation.addedNodes,...mutation.removedNodes].some(node=>node.classList&&(node.classList.contains('dan-parallax-slider__container')||node.classList.contains('dan-parallax-slider__item')));if(hasChanges){dancepad_parallax_slider();break}}}});const sliderElements=document.querySelectorAll('.dan-parallax-slider');sliderElements.forEach(element=>{observer.observe(element,{childList:!0,subtree:!0})});return observer}