class NextFlipbox{constructor(element){this.container=element;this.wrapper=element.querySelector('.dan-flipbox__wrapper');this.frontSide=element.querySelector('.dan-flipbox__flip--front');this.backSide=element.querySelector('.dan-flipbox__flip--back');this.isPreview=window.location.href.includes('breakdance_iframe');this.config={trigger:element.getAttribute('data-trigger')};this.observer=null;this.handleResize=this.handleResize.bind(this);this.handleContainerClick=this.handleContainerClick.bind(this);this.handleDocumentClick=this.handleDocumentClick.bind(this);this.handleMouseEnter=this.handleMouseEnter.bind(this);this.handleMouseLeave=this.handleMouseLeave.bind(this);this.init()}
static instances=[];static destroyAll(){NextFlipbox.instances.forEach(instance=>instance.destroy());NextFlipbox.instances=[]}
handleResize(){const heightValue=getComputedStyle(this.container).getPropertyValue('--height').trim();if(heightValue==='auto'||heightValue==='fit-content'){this.frontSide.style.height='auto';this.backSide.style.height='auto';const frontHeight=this.frontSide.offsetHeight;const backHeight=this.backSide.offsetHeight;const maxHeight=Math.max(frontHeight,backHeight);this.container.style.height=`${maxHeight}px`;this.frontSide.style.height=`${maxHeight}px`;this.backSide.style.height=`${maxHeight}px`}}
focusFirstFocusable(side){const focusableElements=Array.from(side.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])'));if(focusableElements.length>0){focusableElements[0].focus()}}
setupFocusHandling(){this.frontSide.addEventListener('focusout',(e)=>{if(!this.frontSide.contains(e.relatedTarget)){this.wrapper.setAttribute('data-flipped','')}});this.backSide.addEventListener('focusout',(e)=>{if(!this.backSide.contains(e.relatedTarget)){this.wrapper.removeAttribute('data-flipped')}});this.frontSide.addEventListener('focusin',()=>{this.focusFirstFocusable(this.frontSide)});this.backSide.addEventListener('focusin',()=>{this.focusFirstFocusable(this.backSide)})}
handleMouseEnter(){this.wrapper.setAttribute('data-flipped','')}
handleMouseLeave(){this.wrapper.removeAttribute('data-flipped')}
handleContainerClick(){if(this.isPreview){this.wrapper.setAttribute('data-flipped','')}else{this.wrapper.hasAttribute('data-flipped')?this.wrapper.removeAttribute('data-flipped'):this.wrapper.setAttribute('data-flipped','')}}
handleDocumentClick(e){if(!this.container.contains(e.target)){this.wrapper.removeAttribute('data-flipped')}}
setupTriggers(){if(this.config.trigger==='hover'){this.container.addEventListener('mouseenter',this.handleMouseEnter);this.container.addEventListener('mouseleave',this.handleMouseLeave)}else if(this.config.trigger==='click'){this.container.addEventListener('click',this.handleContainerClick);document.addEventListener('click',this.handleDocumentClick)}}
setupObserver(){this.observer=new MutationObserver(this.handleResize);this.observer.observe(this.container,{childList:!0,subtree:!0})}
init(){this.container.removeAttribute('data-dan-hide');this.handleResize();this.setupFocusHandling();this.setupTriggers();this.setupObserver();window.addEventListener('resize',this.handleResize)}
destroy(){window.removeEventListener('resize',this.handleResize);if(this.config.trigger==='hover'){this.container.removeEventListener('mouseenter',this.handleMouseEnter);this.container.removeEventListener('mouseleave',this.handleMouseLeave)}else if(this.config.trigger==='click'){this.container.removeEventListener('click',this.handleContainerClick);document.removeEventListener('click',this.handleDocumentClick)}
if(this.observer){this.observer.disconnect()}
if(this.container){this.container.style.height=''}
if(this.frontSide){this.frontSide.style.height=''}
if(this.backSide){this.backSide.style.height=''}
if(this.wrapper){this.wrapper.removeAttribute('data-flipped')}
this.container=null;this.wrapper=null;this.frontSide=null;this.backSide=null;this.observer=null}}
function dancepad_flipbox(){NextFlipbox.destroyAll();document.querySelectorAll('.dan-flipbox').forEach(element=>{element.removeAttribute('data-flickering');const instance=new NextFlipbox(element);NextFlipbox.instances.push(instance)})}