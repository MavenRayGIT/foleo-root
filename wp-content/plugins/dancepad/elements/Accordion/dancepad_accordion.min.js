class NextAccordion{constructor(element){this.wrapper=element;this.questions=element.querySelectorAll('.dan-accordion-question');this.config={mode:element.getAttribute('data-mode'),duration:parseFloat(element.getAttribute('data-contenttransitionduration')),openThis:element.getAttribute('data-openthis'),singleOpen:element.getAttribute('data-singleopen'),openAll:element.getAttribute('data-openall')==='true'};this.init()}
static instances=[];static destroyAll(){NextAccordion.instances.forEach(instance=>instance.destroy());NextAccordion.instances=[]}
init(){if(this.config.openAll){this.handleOpenAll()}
this.setupExpanders();this.handleInitialStates()}
handleOpenAll(){this.config.singleOpen='false';this.config.mode='click';this.questions.forEach(question=>{question.classList.add('dan-accordion-active');const content=question.nextElementSibling;content.style.maxHeight=`${content.scrollHeight}px`})}
toggleExpander(question){question.classList.toggle('dan-accordion-active');const content=question.nextElementSibling;if(question.classList.contains('dan-accordion-active')){content.style.maxHeight=`${content.scrollHeight}px`;this.updateLenis()}else{content.style.maxHeight='0';this.updateLenis()}}
updateLenis(){if(typeof lenisInstance!=='undefined'&&lenisInstance){setTimeout(()=>{lenisInstance.resize()},this.config.duration*1000+100)}}
handleSingleOpen(question){if(this.config.singleOpen==='true'){const activeQuestion=this.wrapper.querySelector('.dan-accordion-question.dan-accordion-active');if(activeQuestion&&activeQuestion!==question){activeQuestion.classList.remove('dan-accordion-active');activeQuestion.nextElementSibling.style.maxHeight='0'}}}
setupExpanders(){this.questions.forEach(question=>{const container=question.closest('.dan-accordion-container');question.setAttribute('tabindex','0');if(this.config.mode==='hover'){this.setupHoverEvents(container,question)}else if(this.config.mode==='click'){this.setupClickEvents(question)}
this.setupKeyboardEvents(question)})}
setupHoverEvents(container,question){const handleMouseEnter=()=>{this.toggleExpander(question)};const handleMouseLeave=()=>{this.toggleExpander(question)};container.addEventListener('mouseenter',handleMouseEnter);container.addEventListener('mouseleave',handleMouseLeave);container._accordionEvents={mouseenter:handleMouseEnter,mouseleave:handleMouseLeave}}
setupClickEvents(question){const handleClick=()=>{this.handleSingleOpen(question);this.toggleExpander(question)};question.addEventListener('click',handleClick);question._accordionEvents={click:handleClick}}
setupKeyboardEvents(question){const handleKeydown=(event)=>{if(event.key==='Enter'||event.key===' '){event.preventDefault();this.handleSingleOpen(question);this.toggleExpander(question)}};question.addEventListener('keydown',handleKeydown);if(!question._accordionEvents){question._accordionEvents={}}
question._accordionEvents.keydown=handleKeydown}
handleInitialStates(){if(this.config.openThis!==''){const index=parseFloat(this.config.openThis)-1;if(this.questions[index]){this.questions[index].classList.add('dan-accordion-active');const content=this.questions[index].nextElementSibling;content.style.maxHeight=`${content.scrollHeight}px`}}}
destroy(){this.questions.forEach(question=>{const container=question.closest('.dan-accordion-container');if(container&&container._accordionEvents){Object.entries(container._accordionEvents).forEach(([event,handler])=>{container.removeEventListener(event,handler)});delete container._accordionEvents}
if(question._accordionEvents){Object.entries(question._accordionEvents).forEach(([event,handler])=>{question.removeEventListener(event,handler)});delete question._accordionEvents}
question.classList.remove('dan-accordion-active');const content=question.nextElementSibling;if(content){content.style.maxHeight=''}
question.removeAttribute('tabindex')});this.wrapper=null;this.questions=null}}
function dancepad_accordion(){NextAccordion.destroyAll();document.querySelectorAll('.dan-accordion').forEach(element=>{const instance=new NextAccordion(element);NextAccordion.instances.push(instance)});initializeAccordionObserver()}
function initializeAccordionObserver(){const breakdanceCanvas=document.querySelector('#breakdance_canvas');if(!breakdanceCanvas)return;const observer=new MutationObserver((mutations)=>{for(const mutation of mutations){if(mutation.type==='childList'){const hasNewQuestion=Array.from(mutation.addedNodes).some(node=>node.classList&&node.classList.contains('dan-accordion-container'));if(hasNewQuestion){dancepad_accordion();break}}}});const accordionElements=document.querySelectorAll('.dan-accordion');accordionElements.forEach(element=>{observer.observe(element,{childList:!0,subtree:!0})});return observer}